/*! todomvc-iris 2013-05-05 */
iris.path={welcome:{js:"welcome.js",html:"welcome.html"},todo:{js:"todo.js",html:"todo.html"},resource:"resource.js"},$(window.document).ready(function(){iris.baseUri("./app/"),iris.welcome(iris.path.welcome.js)}),iris.resource(function(e){function t(){if(r){for(var e="",t=0;o.length>t;t++)e+=";"+JSON.stringify(o[t]);localStorage.todos=e.substr(1)}}var o=[],i=0,r=!1;e.init=function(){if(uis=[],void 0!==Storage&&(console.log("reading todos from storage... "),r=!0,void 0!==localStorage.todos&&""!==localStorage.todos))for(var e=localStorage.todos.split(";"),t=0;e.length>t;t++){var n=JSON.parse(e[t]);n.completed||++i,o.push(n),iris.notify("create-todo",n)}iris.notify("render-list")},e.add=function(e){i++;var r={id:(new Date).getTime(),text:e,completed:!1};o.push(r),iris.notify("create-todo",r),iris.notify("render-list"),t()},e.remove=function(e){e.completed||--i,o.splice(o.indexOf(e),1),iris.notify("render-list"),t()},e.toggle=function(e){e.completed=!e.completed,e.completed?--i:++i,iris.notify("render-list"),iris.notify("render-todo",e.id),t()},e.removeCompleted=function(){for(var e=o.length-1;e>=0;e--){var i=o[e];i.completed&&(iris.notify("destroy-todo",i.id),o.splice(e,1))}iris.notify("render-list"),t()},e.setAll=function(e){for(var r=0;o.length>r;r++){var n=o[r];n.completed!==e&&(n.completed=e,iris.notify("render-todo",n.id))}i=e?0:o.length,t()},e.edit=function(){t()},e.count=function(){return o.length},e.remainingCount=function(){return i},e.completedCount=function(){return o.length-i}},iris.path.resource),iris.ui(function(e){var t=iris.resource(iris.path.resource);e.create=function(){e.tmplMode(e.APPEND),e.tmpl(iris.path.todo.html),e.get("check").on("click",function(){t.toggle(e.data),e.render()}),e.get("destroy").on("click",function(){t.remove(e.data),e.destroyUI()}),e.get().on("dblclick",function(){e.get().addClass("editing"),e.get("text").select()}),e.get("text").on("blur change",function(){e.get().removeClass("editing"),""!==this.value.trim()?(t.edit(),e.data.text=this.value,e.render()):this.value=e.data.text}),e.get().hide().fadeIn("slow")},e.render=function(t){void 0!==t&&(e.data=t),e.data.completed?e.get().addClass("completed"):e.get().removeClass("completed"),e.get("check").prop("checked",e.data.completed),e.inflate(e.data)}},iris.path.todo.js),iris.screen(function(e){function t(){e.inflate({completed:"Clear completed ("+n.completedCount()+")",remaining:n.remainingCount()}),n.completedCount()>0?e.get("clear-completed").show():e.get("clear-completed").hide()}function o(){t(),0===n.count()?(e.get("toggle-all").hide(),e.get("footer").hide()):(e.get("toggle-all").show(),e.get("footer").show()),e.get("toggle-all").prop("checked",0===n.remainingCount())}function i(e){"all"===l||e.data.completed&&"completed"===l||!e.data.completed&&"active"===l?e.show():e.hide()}function r(t){l=t;for(var o=0;e.uis.length>o;o++)i(e.uis[o])}var n=iris.resource(iris.path.resource),l="all",d={};e.create=function(){e.tmpl(iris.path.welcome.html),e.get("new-todo").on("keyup",function(e){13===e.keyCode&&""!==this.value.trim()&&(n.add(this.value),this.value="")}),e.get("toggle-all").on("mousedown",function(){var o=e.get("toggle-all").prop("checked");n.setAll(!o),t()}),e.get("clear-completed").on("click",n.removeCompleted),e.on("render-list",o),e.on("create-todo",function(t){console.log("creating todo... ",t);var o=e.ui("todo-list",iris.path.todo.js);o.render(t),i(o),d[t.id]=o}),e.on("destroy-todo",function(t){console.log("destroying todo... ",t),e.destroyUI(d[t])}),e.on("render-todo",function(e){var t=d[e];t.render(),i(t)}),n.init()},e.awake=function(e){void 0!==e&&e.hasOwnProperty("filter")&&(console.log("set filter = "+e.filter),r(e.filter),$(".selected").removeClass("selected"),$("a[href='#?filter="+e.filter+"']").addClass("selected"))}},iris.path.welcome.js);iris.tmpl("todo.html", "<li><div class=\"view\">  <input data-id=\"check\" class=\"toggle\" type=\"checkbox\">  <label data-model=\"text\"></label>    <button data-id=\"destroy\" class=\"destroy\"></button></div><input data-id=\"text\" data-model=\"text\" class=\"edit\" value=\"\"></li>");
iris.tmpl("welcome.html", "<div>  <section id=\"todoapp\">    <header id=\"header\">      <h1>todos</h1>      <input id=\"new-todo\" data-id=\"new-todo\" placeholder=\"What needs to be done?\" autofocus>    </header>        <section id=\"main\">      <input id=\"toggle-all\" data-id=\"toggle-all\" type=\"checkbox\">      <label for=\"toggle-all\">Mark all as complete</label>      <ul id=\"todo-list\" data-id=\"todo-list\"></ul>    </section>    <footer id=\"footer\" data-id=\"footer\">      <span id=\"todo-count\"><strong data-model=\"remaining\"></strong> item left</span>      <ul id=\"filters\">        <li>          <a class=\"selected\" href=\"#?filter=all\">All</a>        </li>        <li>          <a href=\"#?filter=active\">Active</a>        </li>        <li>          <a href=\"#?filter=completed\">Completed</a>        </li>      </ul>      <button id=\"clear-completed\" data-id=\"clear-completed\" data-model=\"completed\"></button>    </footer>  </section>  <footer id=\"info\">    <p>Double-click to edit a todo</p>    <p>Created by <a href=\"http://thegameofcode.github.com/iris\">Iris</a></p>    <p>Part of <a href=\"http://todomvc.com\">TodoMVC</a></p>  </footer></div>");
